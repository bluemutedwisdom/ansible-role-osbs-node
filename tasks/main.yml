---
- name: open kubelet port
  firewalld:
    port: 10250/tcp
    state: enabled
    permanent: true
    immediate: true
  when: osbs_manage_firewalld

- name: apply modifications to /etc/sysconfig/origin
  copy: src=sysconfig-origin-node dest=/etc/sysconfig/origin-node
  notify: restart openshift-node

- name: check for configuration generated by RPM
  stat: path=/etc/origin/.config_managed
  register: rpm_config_managed

- name: remove configuration generated by RPM
  file: path=/etc/origin/{{ item }} state=absent
  with_items:
  - master
  - node
  - .config_managed
  when: rpm_config_managed.stat.exists

- name: copy configuration tarball from ansible host
  unarchive:
    src: "{{ osbs_node_config_dir }}/node-{{ ansible_fqdn }}.tar.xz"
    dest: /etc/origin
    copy: yes

- name: link /etc/origin/node to actual node directory
  file: path=/etc/origin/node src=/etc/origin/node-{{ ansible_fqdn }} force=yes state=link

- name: ensure openshift is running
  service: name=origin-node state=started enabled=yes
