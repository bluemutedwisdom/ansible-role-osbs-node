---
- name: open kubelet port
  firewalld:
    port: 10250/tcp
    state: enabled
    permanent: true
    immediate: true
  when: osbs_manage_firewalld

- name: apply modifications to /etc/sysconfig/origin
  template: src=sysconfig-origin-node.j2 dest=/etc/sysconfig/origin-node
  notify: restart openshift-node

- name: remove configuration marker generated by RPM
  file: path=/etc/origin/.config_managed state=absent

- name: copy configuration tarball from ansible host
  unarchive:
    src: "{{ osbs_node_config_dir }}/node-{{ ansible_fqdn }}.tar.xz"
    dest: /etc/origin
    copy: yes

- name: link /etc/origin/node to actual node directory
  file: path=/etc/origin/node src=/etc/origin/node-{{ ansible_fqdn }} force=yes state=link

- name: ensure openshift is running
  service: name=origin-node state=started enabled=yes
